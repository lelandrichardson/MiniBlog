"use strict";(function(n,t,i){var r=function(r){var u=this,f,e;return r=r||{},u.title=n.observable(r.title||""),u.slug=n.observable(r.slug||""),u.id=n.numericObservable(r.id||0),u.publishDate=n.observable(r.publishDate||"").extend({isoDate:"mm/dd/yyyy"}),u.body=n.observable(r.body||""),u.dateCreated=n.observable(r.dateCreated||"").extend({isoDate:"mm/dd/yyyy"}),u.tags=n.observableArray([]),u.tagInput=n.observable(""),u.addTag=function(){u.tags.push(u.tagInput()),u.tagInput("")},u.removeTag=function(n){u.tags.remove(n)},u.meta=n.observableArray([]),u.status=n.observable(""),u.type=n.observable("B"),u.typeOptions=[{label:"Blog Post",id:"B"},{label:"Page",id:"P"}],u.allowComments=n.observable(!0),u.includeSocial=n.observable(!1),u.dirtyFlag=n.dirtyFlag([u.title,u.slug,u.id,u.body,u.dateCreated,u.tags,u.meta,u.type,u.allowComments,u.includeSocial]),u.bodyDirtyFlag=n.dirtyFlag([u.body]),f=function(n){var i=/( ?- ?)|[ ']/g,t=/[^0-9a-zA-Z-]/g;return n.replace(i,"-").replace(t,"").trim().toLowerCase()},u.updateSlug=function(){u.isSlugBound()&&u.slug(f(u.title()))},u.slugKeyDown=function(){u.isSlugBound(!1)},u.isSlugBound=n.observable(!0),u.isSlugBound.subscribe(function(){}),u.allowSave=n.dependentObservable(function(){return u.slug().length>0&&u.title().length>0}),u.save=function(){u.id()>0?u.saveAll():u.create()},u.publishOrUnpublish=n.dependentObservable(function(){return u.status()=="A"?"Unpublish":"Publish"}),u.body.subscribe(function(){clearTimeout(e),e=setTimeout(function(){u.saveBody()},2e3)}),u.saveBody=function(){if(u.status()=="A"||u.id()===0)return;t.ajax({url:"/ajax/posts/update",type:"POST",contentType:"application/json",processData:!1,data:JSON.stringify({method:"save-body",data:{id:u.id(),body:u.body()}}),success:function(n){n&&u.bodyDirtyFlag.reset()}})},u.create=function(){t.ajax({url:"/ajax/posts/insert",type:"POST",contentType:"application/json",processData:!1,data:JSON.stringify({method:"insert",data:{title:u.title(),slug:u.slug(),status:u.status(),type:u.type(),body:u.body(),allowComments:u.allowComments(),includeSocial:u.includeSocial(),tags:u.tags()}}),success:function(n){n&&(u.id(n.data||0),u.dirtyFlag.reset(),u.bodyDirtyFlag.reset())}})},u.load=function(n){u.id(n),t.getJSON("/ajax/posts/get?id="+n,function(n){u.title(n.title),u.slug(n.slug),u.body(n.body),u.status(n.status),u.type(n.type),u.dateCreated(n.dateCreated),u.publishDate(n.publishDate),u.allowComments(n.allowComments),u.includeSocial(n.includeSocial),u.tags(n.tags),u.isSlugBound(u.slug()===f(u.title())),u.dirtyFlag.reset(),u.bodyDirtyFlag.reset()})},u.saveAll=function(){t.ajax({url:"/ajax/posts/update",type:"POST",contentType:"application/json",processData:!1,data:JSON.stringify({method:"save-all",data:{id:u.id(),title:u.title(),slug:u.slug(),status:u.status(),type:u.type(),body:u.body(),allowComments:u.allowComments(),includeSocial:u.includeSocial(),tags:u.tags()}}),success:function(n){n&&(u.dirtyFlag.reset(),u.bodyDirtyFlag.reset())}})},u.publish=function(){t.getJSON("/ajax/posts/publish?id="+u.id(),function(n){n&&n.success===1&&(u.publishDate(n.data.publishDate),u.status(n.data.status))})},u.preview=function(){i.open("/post.cshtml?id={0}".format(u.id()))},u};i.viewModel=new r,n.applyBindings(i.viewModel)})(ko,jQuery,window)